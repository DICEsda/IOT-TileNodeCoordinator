<div class="dashboard-container">
  <!-- Header with Navigation -->
  <header class="dashboard-header">
    <div class="header-content">
      <div class="logo">
        <svg width="32" height="32" viewBox="0 0 32 32" fill="none">
          <path d="M16 4L4 10V22L16 28L28 22V10L16 4Z" stroke="#ffffff" stroke-width="2" fill="none"/>
          <circle cx="16" cy="16" r="4" fill="#ffffff"/>
        </svg>
        <h1>SmartLight</h1>
      </div>

      <nav class="header-navigation">
        <button
          class="tab-button"
          [class.active]="activeTab() === 'monitor'"
          (click)="setActiveTab('monitor')">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M12 2l9 4.9V12c0 5.25-3.6 10.17-9 11.4-5.4-1.23-9-6.15-9-11.4V6.9L12 2z"/>
          </svg>
          Live Monitor
        </button>
        <button
          class="tab-button"
          [class.active]="activeTab() === 'devices'"
          (click)="setActiveTab('devices')">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <rect x="4" y="4" width="16" height="16" rx="2"/>
            <circle cx="12" cy="12" r="3"/>
          </svg>
          Devices & Sensors
        </button>


        <button
          class="tab-button"
          [class.active]="activeTab() === 'customize'"
          (click)="setActiveTab('customize')">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
          </svg>
          Customize
        </button>
        <button
          class="tab-button"
          [class.active]="activeTab() === 'settings'"
          (click)="setActiveTab('settings')">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="3"/>
            <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/>
          </svg>
          Settings
        </button>
      </nav>

      <div class="header-info">
        <span class="time">{{ getCurrentTime() }}</span>
        <div class="health-indicators">
          <div class="health-item" [class.healthy]="data.apiHealthy()" title="Backend API">
            <span class="health-dot" [class.active]="data.apiHealthy()"></span>
            <span class="health-label">API</span>
          </div>
          <div class="health-item" [class.healthy]="data.dbHealthy()" title="MongoDB Database">
            <span class="health-dot" [class.active]="data.dbHealthy()"></span>
            <span class="health-label">DB</span>
          </div>
          <div class="health-item" [class.healthy]="data.mqttBrokerHealthy()" title="MQTT Broker">
            <span class="health-dot" [class.active]="data.mqttBrokerHealthy()"></span>
            <span class="health-label">MQTT</span>
          </div>
          <div class="health-item" [class.healthy]="data.coordOnline()" title="Coordinator Status">
            <span class="health-dot" [class.active]="data.coordOnline()"></span>
            <span class="health-label">Coordinator</span>
          </div>
          <div class="divider"></div>
          <div class="status-indicator" [class.active]="isHealthy()">
            <span class="status-dot" [class.active]="isHealthy()"></span>
            <span>{{ isHealthy() ? 'System Active' : 'System Degraded' }}</span>
          </div>
        </div>
      </div>
    </div>
  </header>

  <!-- Tab Content (hidden until connections are healthy) -->
  <main class="tab-content" *ngIf="isHealthy(); else connectionNotice">
    @if (activeTab() === 'monitor') {
      <div class="monitor-layout">
        <!-- Top Section: Radar & Light Monitor -->
        <div class="bottom-section">
          <div class="visualizer-section">
            <app-room-visualizer 
              [siteId]="'site001'"
              [coordinatorId]="'coord001'"
              (lightStateChanged)="onLightStateChanged($event)"
              [registeredNodes]="registeredNodes()">
            </app-room-visualizer>
          </div>
          <div class="monitor-section">
            <app-light-monitor 
              [totalActiveLights]="totalActiveLights()" 
              [lightNodeStates]="lightNodeStates()"
              [registeredNodes]="registeredNodes()">
            </app-light-monitor>
          </div>
        </div>

        <!-- Network Graph (Bottom) -->
        <div class="graph-section">
          <app-network-graph
            [nodes]="registeredNodes()"
            [coordinators]="registeredCoordinators()"
            [backendHealthy]="data.apiHealthy()"
            [dbHealthy]="data.dbHealthy()"
            [mqttHealthy]="data.mqttBrokerHealthy()"
            [frontendHealthy]="true">
          </app-network-graph>
        </div>
      </div>
    }
    @if (activeTab() === 'devices') {
      <app-devices></app-devices>
    }


    @if (activeTab() === 'customize') {
      <app-customize></app-customize>
    }
    @if (activeTab() === 'settings') {
      <app-settings-new></app-settings-new>
    }
  </main>

  <ng-template #connectionNotice>
    <div style="display:flex;flex-direction:column;gap:12px;align-items:center;justify-content:center;padding:40px;color:#666;">
      <h3 style="margin:0;">Waiting for connections…</h3>
      <div style="display:flex;gap:16px;">
        <span>API: {{ data.apiHealthy() ? '✓' : '✗' }}</span>
        <span>WebSocket: {{ data.wsConnected() ? '✓' : '✗' }}</span>
        <span>MQTT: {{ data.mqttConnected() ? '✓' : '✗' }}</span>
      </div>
      <small>Dashboard content appears once the system is live.</small>
    </div>
  </ng-template>
</div>

