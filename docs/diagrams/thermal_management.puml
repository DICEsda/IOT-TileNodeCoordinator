@startuml Thermal Management
title Smart Tile System - Thermal Management Sequence

participant "Node" as node
participant "Temperature\nSensor" as temp
participant "LED Controller" as led
participant "ESP-NOW" as espnow
participant "Coordinator" as coord
participant "Thermal Control" as thermal
participant "MQTT" as mqtt

== Temperature Monitoring ==
node -> temp: Read temperature
activate temp
temp --> node: temperature value
deactivate temp

node -> node: Check thresholds
activate node

alt Temperature above threshold
    node -> led: Derate brightness
    activate led
    led --> node: Applied
    deactivate led
    
    node -> espnow: Send thermal status
    activate espnow
    espnow -> coord: NODE_STATUS
    activate coord
    
    coord -> thermal: updateNodeTemperature()
    activate thermal
    thermal -> thermal: Calculate deration
    thermal -> thermal: Update node status
    thermal --> coord: Updated
    deactivate thermal
    
    coord -> mqtt: publishThermalEvent()
    activate mqtt
    mqtt --> coord: Published
    deactivate mqtt
    
    coord --> espnow: ACK
    deactivate coord
    espnow --> node: Received
    deactivate espnow
end

deactivate node

@enduml
